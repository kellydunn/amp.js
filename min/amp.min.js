(function(c){var a=null,a="undefined"!==typeof exports?exports:this.Amp={},f=[],g=new Float32Array(2048);new Float32Array(2048);var e={};a.define=function(b,a,d){if("function"===typeof define&&define.amd)define(b,a,d);else{if(a&&a.length)for(var c=0;c<a.length;c++)a[c]=e[a[c]];e[b]=d.apply(this,a||[])}};"undefined"===typeof define&&(c.define=a.define);a.Manager={ZOOM:100,range:32,timeout:10,jsProcessor:0,source:0,init_page:function(){this.context=this.api=null;this.initAudio();if(this.api!=null&&
this.api=="webkit")this.fft=new FFT(2048,44100)},init_moz_page:function(){a.Manager.fft=new FFT(a.Manager.context.mozFrameBufferLength,a.Manager.context.mozSampleRate)},loadSample:function(b){a.Request.initialize({url:b}).send()},stop:function(){if(this.source!=0){this.stopped=true;this.source.noteOff(0)}},initAudio:function(){if(typeof webkitAudioContext=="undefined"){this.api="mozilla";a.Manager.context=new Audio;a.Manager.context.src="/images/milkshake.ogg";a.Manager.context.addEventListener("MozAudioAvailable",
this.audioAvailable,false);a.Manager.context.addEventListener("loadedmetadata",this.init_moz_page,false);a.Manager.context.play();a.Visualizer.animate()}else{this.api="webkit";this.context=new webkitAudioContext;this.context.sampleRate=44100;a.Manager.source=this.context.createBufferSource();this.jsProcessor=this.context.createJavaScriptNode(4096,1,2);this.jsProcessor.onaudioprocess=this.audioAvailable.bind(this);a.Manager.source.connect(this.jsProcessor);this.jsProcessor.connect(this.context.destination);
this.loadSample(this.url)}},audioAvailable:function(b){if(this.api!=null&&this.api=="webkit")for(var c=b.inputBuffer.getChannelData(0),d=b.inputBuffer.getChannelData(1),e=b.outputBuffer.getChannelData(0),h=b.outputBuffer.getChannelData(1),i=c.length,b=0;b<i;b++){e[b]=c[b];h[b]=d[b];g[b]=(c[b]+d[b])/2}else if(a.Manager.api!=null&&a.Manager.api=="mozilla"){c=b.frameBuffer;d=a.Manager.context.mozFrameBufferLength;b=0;for(d=d/2;b<d;b++)g[b]=(c[2*b]+c[2*b+1])/2}a.Manager.fft.forward(g);for(b=0;b<2048/
a.Manager.range;b++)f[b]=a.Manager.fft.spectrum[b]*a.Manager.ZOOM}};a.Visualizer={canvas:document.getElementById("fft"),color:"#EEEEEE",bar_width:50,bar_gap:50,animate:function(){this.bar_height=this.canvas.height;this.ctx=this.canvas.getContext("2d");this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle=this.color;for(var b=0;b<f.length;b++)this.ctx.fillRect(b*this.bar_gap,this.bar_height,this.bar_width,-f[b]*3);t=setTimeout("Amp.Visualizer.animate()",a.Manager.timeout);
if(this.stopped){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);clearTimeout(t)}}}})("undefined"===typeof window?this:window);
define("Amp.Request",["Amp"],function(){Amp.Request={type:"GET",initialize:function(c,a){null==c&&(c=[],c.url="");this.self=new XMLHttpRequest;this.self.open(this.type,c.url,!0);this.self.responseType="arraybuffer";this.self.onload=null!=a?a:function(){Amp.Manager.source.buffer=Amp.Manager.context.createBuffer(this.self.response,true);Amp.Manager.source.loop=false;Amp.Manager.source.noteOn(0);Amp.Visualizer.animate()}.bind(this);return this.self}}});
