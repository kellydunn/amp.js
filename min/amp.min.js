(function(c){var b=null,b="undefined"!==typeof exports?exports:this.Amp={},f=[],g=new Float32Array(2048);new Float32Array(2048);var e={};b.define=function(a,b,d){if("function"===typeof define&&define.amd)define(a,b,d);else{if(b&&b.length)for(var c=0;c<b.length;c++)b[c]=e[b[c]];e[a]=d.apply(this,b||[])}};"undefined"===typeof define&&(c.define=b.define);b.Manager={ZOOM:100,range:32,timeout:10,jsProcessor:0,source:0,init_page:function(){this.context=this.api=null;this.initAudio();if(this.api!=null&&
this.api=="webkit")this.fft=new FFT(2048,44100)},init_moz_page:function(){this.fft=new FFT(this.context.mozFrameBufferLength,this.context.mozSampleRate)},loadSample:function(a){b.Request.initialize({url:a}).send()},stop:function(){if(this.source!=0){this.stopped=true;this.source.noteOff(0)}},initAudio:function(){if(typeof webkitAudioContext=="undefined"){this.api="mozilla";this.context=new Audio;this.context.src="/images/milkshake.ogg";this.context.addEventListener("MozAudioAvailable",this.audioAvailable,
false);this.context.addEventListener("loadedmetadata",this.init_moz_page,false);this.context.play();b.Visualizer.animate()}else{this.api="webkit";this.context=new webkitAudioContext;this.context.sampleRate=44100;b.Manager.source=this.context.createBufferSource();this.jsProcessor=this.context.createJavaScriptNode(4096,1,2);this.jsProcessor.onaudioprocess=this.audioAvailable.bind(this);b.Manager.source.connect(this.jsProcessor);this.jsProcessor.connect(this.context.destination);this.loadSample(this.url)}},
audioAvailable:function(a){if(this.api!=null&&this.api=="webkit")for(var c=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),e=a.outputBuffer.getChannelData(0),h=a.outputBuffer.getChannelData(1),i=c.length,a=0;a<i;a++){e[a]=c[a];h[a]=d[a];g[a]=(c[a]+d[a])/2}else if(b.Manager.api!=null&&b.Manager.api=="mozilla"){c=a.frameBuffer;d=this.context.mozFrameBufferLength;a=0;for(d=d/2;a<d;a++)g[a]=(c[2*a]+c[2*a+1])/2}this.fft.forward(g);for(a=0;a<2048/b.Manager.range;a++)f[a]=this.fft.spectrum[a]*
b.Manager.ZOOM}};b.Visualizer={canvas:document.getElementById("fft"),color:"#EEEEEE",bar_width:50,bar_gap:50,animate:function(){this.bar_height=this.canvas.height;this.ctx=this.canvas.getContext("2d");this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle=this.color;for(var a=0;a<f.length;a++)this.ctx.fillRect(a*this.bar_gap,this.bar_height,this.bar_width,-f[a]*3);t=setTimeout("Amp.Visualizer.animate()",b.Manager.timeout);if(this.stopped){this.ctx.clearRect(0,0,this.canvas.width,
this.canvas.height);clearTimeout(t)}}}})("undefined"===typeof window?this:window);
define("Amp.Request",["Amp"],function(){Amp.Request={type:"GET",initialize:function(c,b){null==c&&(c=[],c.url="");this.self=new XMLHttpRequest;this.self.open(this.type,c.url,!0);this.self.responseType="arraybuffer";this.self.onload=null!=b?b:function(){Amp.Manager.source.buffer=Amp.Manager.context.createBuffer(this.self.response,true);Amp.Manager.source.loop=false;Amp.Manager.source.noteOn(0);Amp.Visualizer.animate()}.bind(this);return this.self}}});
