(function(){var b=null,b="undefined"!==typeof exports?exports:this.Amp={},c,f=[],g=new Float32Array(2048);new Float32Array(2048);b.Request={type:"GET",initialize:function(a,d){null==a&&(a=[],a.url="");this.self=new XMLHttpRequest;this.self.open(this.type,a.url,!0);this.self.responseType="arraybuffer";this.self.onload=null!=d?d:function(){b.Manager.source.buffer=c.createBuffer(this.self.response,true);b.Manager.source.loop=false;b.Manager.source.noteOn(0);b.Visualizer.animate()}.bind(this);return this.self}};
b.Manager={ZOOM:100,range:32,timeout:10,jsProcessor:0,source:0,init_page:function(){this.api=null;this.initAudio();null!=this.api&&"webkit"==this.api&&(this.fft=new FFT(2048,44100))},init_moz_page:function(){this.fft=new FFT(c.mozFrameBufferLength,c.mozSampleRate)},loadSample:function(a){b.Request.initialize({url:a}).send()},stop:function(){0!=this.source&&(this.stopped=!0,this.source.noteOff(0))},initAudio:function(){"undefined"==typeof webkitAudioContext?(this.api="mozilla",c=new Audio,c.src="/images/milkshake.ogg",
c.addEventListener("MozAudioAvailable",this.audioAvailable,!1),c.addEventListener("loadedmetadata",this.init_moz_page,!1),c.play(),b.Visualizer.animate()):(this.api="webkit",c=new webkitAudioContext,c.sampleRate=44100,b.Manager.source=c.createBufferSource(),this.jsProcessor=c.createJavaScriptNode(4096,1,2),this.jsProcessor.onaudioprocess=this.audioAvailable.bind(this),b.Manager.source.connect(this.jsProcessor),this.jsProcessor.connect(c.destination),this.loadSample(this.url))},audioAvailable:function(a){if(null!=
this.api&&"webkit"==this.api)for(var d=a.inputBuffer.getChannelData(0),e=a.inputBuffer.getChannelData(1),h=a.outputBuffer.getChannelData(0),i=a.outputBuffer.getChannelData(1),j=d.length,a=0;a<j;a++)h[a]=d[a],i[a]=e[a],g[a]=(d[a]+e[a])/2;else if(null!=b.Manager.api&&"mozilla"==b.Manager.api){d=a.frameBuffer;e=c.mozFrameBufferLength;a=0;for(e/=2;a<e;a++)g[a]=(d[2*a]+d[2*a+1])/2}this.fft.forward(g);for(a=0;a<2048/b.Manager.range;a++)f[a]=this.fft.spectrum[a]*b.Manager.ZOOM}};b.Visualizer={canvas:document.getElementById("fft"),
color:"#EEEEEE",bar_width:50,bar_gap:50,animate:function(){this.bar_height=this.canvas.height;this.ctx=this.canvas.getContext("2d");this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle=this.color;for(var a=0;a<f.length;a++)this.ctx.fillRect(a*this.bar_gap,this.bar_height,this.bar_width,3*-f[a]);t=setTimeout("Amp.Visualizer.animate()",b.Manager.timeout);this.stopped&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(t))}}}).call(this);
