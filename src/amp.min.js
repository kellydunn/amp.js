(function(){var d=null,d="undefined"!==typeof exports?exports:this.Amp={},b,c=0,f=[],g=new Float32Array(2048);new Float32Array(2048);d.Request={type:"GET",initialize:function(a,e){null==a&&(a=[],a.url="");this.self=new XMLHttpRequest;this.self.open(this.type,a.url,!0);this.self.responseType="arraybuffer";this.self.onload=null!=e?e:function(){c.buffer=b.createBuffer(this.self.response,true);c.loop=false;c.noteOn(0);d.Visualizer.animate()}.bind(this);return this.self}};d.Manager={ZOOM:100,range:32,
timeout:10,jsProcessor:0,init_page:function(){this.api=null;this.initAudio();null!=this.api&&"webkit"==this.api&&(this.fft=new FFT(2048,44100))},init_moz_page:function(){this.fft=new FFT(b.mozFrameBufferLength,b.mozSampleRate)},loadSample:function(a){d.Request.initialize({url:a}).send()},stop:function(){0!=c&&(this.stopped=!0,c.noteOff(0))},initAudio:function(){"undefined"==typeof webkitAudioContext?(this.api="mozilla",b=new Audio,b.src="/images/milkshake.ogg",b.addEventListener("MozAudioAvailable",
this.audioAvailable,!1),b.addEventListener("loadedmetadata",this.init_moz_page,!1),b.play(),d.Visualizer.animate()):(this.api="webkit",b=new webkitAudioContext,b.sampleRate=44100,c=b.createBufferSource(),this.jsProcessor=b.createJavaScriptNode(4096,1,2),this.jsProcessor.onaudioprocess=this.audioAvailable.bind(this),c.connect(this.jsProcessor),this.jsProcessor.connect(b.destination),this.loadSample(this.url))},audioAvailable:function(a){if(null!=this.api&&"webkit"==this.api)for(var e=a.inputBuffer.getChannelData(0),
c=a.inputBuffer.getChannelData(1),h=a.outputBuffer.getChannelData(0),i=a.outputBuffer.getChannelData(1),j=e.length,a=0;a<j;a++)h[a]=e[a],i[a]=c[a],g[a]=(e[a]+c[a])/2;else if(null!=d.Manager.api&&"mozilla"==d.Manager.api){e=a.frameBuffer;c=b.mozFrameBufferLength;a=0;for(c/=2;a<c;a++)g[a]=(e[2*a]+e[2*a+1])/2}this.fft.forward(g);for(a=0;a<2048/d.Manager.range;a++)f[a]=this.fft.spectrum[a]*d.Manager.ZOOM}};d.Visualizer={canvas:document.getElementById("fft"),color:"#EEEEEE",bar_width:50,bar_gap:50,animate:function(){this.bar_height=
this.canvas.height;this.ctx=this.canvas.getContext("2d");this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle=this.color;for(var a=0;a<f.length;a++)this.ctx.fillRect(a*this.bar_gap,this.bar_height,this.bar_width,3*-f[a]);t=setTimeout("Amp.Visualizer.animate()",d.Manager.timeout);this.stopped&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(t))}}}).call(this);
